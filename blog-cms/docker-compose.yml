version: '3.8'

services:
  blog-cms:
    build: .
    container_name: blog-cms
    restart: unless-stopped
    volumes:
      # Mount the blog repository (adjust path to your actual repo location)
      - /path/to/your/blog/repo:/repo
      # Mount SSH keys for git push (if using SSH)
      - ~/.ssh:/root/.ssh:ro
      # Or mount git credentials
      - ~/.gitconfig:/root/.gitconfig:ro
    environment:
      # Repository path inside container
      - REPO_PATH=/repo
      # CMS credentials (change these!)
      - CMS_USERNAME=admin
      - CMS_PASSWORD=changeme_secure_password
      # Flask secret key (generate a random one!)
      - SECRET_KEY=change-this-to-a-random-secret-key
      # Git configuration
      - GIT_AUTHOR_NAME=Blog CMS
      - GIT_AUTHOR_EMAIL=cms@yourdomain.com
      - GIT_COMMITTER_NAME=Blog CMS
      - GIT_COMMITTER_EMAIL=cms@yourdomain.com
    networks:
      - traefik-network
    labels:
      # Enable Traefik
      - "traefik.enable=true"

      # Router configuration
      - "traefik.http.routers.blog-cms.rule=Host(`cms.yourdomain.com`)"
      - "traefik.http.routers.blog-cms.entrypoints=websecure"
      - "traefik.http.routers.blog-cms.tls=true"
      - "traefik.http.routers.blog-cms.tls.certresolver=letsencrypt"

      # Service configuration
      - "traefik.http.services.blog-cms.loadbalancer.server.port=5000"

      # Middleware (optional - add rate limiting, auth, etc.)
      # - "traefik.http.routers.blog-cms.middlewares=blog-cms-ratelimit"
      # - "traefik.http.middlewares.blog-cms-ratelimit.ratelimit.average=100"

networks:
  traefik-network:
    external: true
