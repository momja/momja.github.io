<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to capture code snippets from Obsidian and add to Alfred Snippets</title>
    <link rel="stylesheet" href="../../tailwind.css">
    <link rel="stylesheet" href="../../codestyle.css">
    <link rel="icon" type="image/png" href="../../favicon.png">
    <script src="https://kit.fontawesome.com/675a0d1294.js" crossorigin="anonymous"></script>
    <script data-goatcounter="https://dizzard.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    <style>
        ol {
            list-style-type: decimal;
        }
    </style>
    <script>
        function goBack() {
            window.history.back();
        }
    </script>
</head>

<body class="bg-white dark:bg-slate-800">
    <div class='back-button mt-8 text-center md:text-left md:ml-8'>
        <button class="bg-transparent text-slate-900 dark:text-white" onclick="goBack()">
            ‚Üê Back
        </button>
    </div>
    <div class="m-4 md:flex md:justify-center">
        <article class="prose lg:prose-xl dark:prose-invert">
            <h1>How to capture code snippets from Obsidian and add to Alfred Snippets</h1>

<p>At work, I'm often looking through my Obsidian notes looking for a certain code snippet to run to update a build version, deploy my server, or some other mundane task I can't be bothered to memorize. And it's nice having obsidian because then not only do I have a home for these little snippets of code, but I can also provide some notes on the snippets, like what it does, why it's written a certain way, what to try if it fails, etc. Sometimes I need this context, but a lot of the times I just need the snippet of code.</p>

<p>Instead of having to take all these snippets, scrub through them to find what's important, and manually add to Alfred, I thought I could do it in an automated fashion. It seemed like a good opportunity to use <code class="codeblock">awk</code>, even though I didn't really understand how it was used. All I knew is that <code class="codeblock">awk</code> is good for parsing through files in a stream, and really that was all I needed to know.</p>

<p>I just had to come up with a way to identify the files I wanted to include as snippets with as little work as possible, and that is where my little scripts name comes from! Introducing <code class="codeblock">sniper</code>, the handy-dandy tool for cloning your obsidian code blocks in Alfred snippets. All you have to do is prefix a code block with the Sniper keyword "snipe" in a markdown comment. This isn't a "smart" utility, so you got to make sure the comment only contains the word "snipe", and nothing else. Here's an example:</p>

<pre class="codewrapper"><code class="codeblock"># Some Markdown file.md

%%snipe%%
````python
print ('hello world!')
</code></pre>

<p>````</p>

<p>To get your flagged snippets to appear in alfred, you will first want to create a new snippets group. Open up "Settings -> Features -> Snippets -> Collections" and click the little "+" button. Then type in the name of the collection. I named mine "Random Code Snippets", but you can name it whatever you want, just make sure to update the bash script variable <code class="codeblock">$ALFRED_SNIPPETS_DIR</code> so it matches your collection.</p>

<p><img src="../../images/alfred_snippets_collection.png" alt="" /></p>

<p>You also need to update <code class="codeblock">$ALFRED_SNIPPETS_DIR</code> so it know where your Alfred config directory is. You can find where your alfred preferences file is by going to "Settings -> Advanced -> Syncing". I keep mine in <code class="codeblock">.config</code> with the rest of my dotfiles</p>

<p><img src="../../images/alfred_preferences.png" alt="" /></p>

<p>My directory path looks like:</p>

<div class="codehilite">
<pre><span></span><code><span class="nv">ALFRED_SNIPPETS_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.config/Alfred.alfredpreferences/snippets/Random Code Snippets&quot;</span>
</code></pre>
</div>

<h2>The Code</h2>

<p>OK, so with the basic setup figured out, you just need this snippet of code (snippets all the way down)!</p>

<div class="codehilite">
<pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Script for swiping snippets (sniping) from obsidian into alfred</span>

<span class="nv">ALFRED_SNIPPETS_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.config/Alfred.alfredpreferences/snippets/Random Code Snippets&quot;</span>

snipe <span class="o">()</span> <span class="o">{</span>
    <span class="nv">MARKDOWN_FILE</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$0</span> <span class="p">|</span> cut -c3-<span class="k">)</span>
    <span class="nv">FILENAME</span><span class="o">=</span><span class="k">$(</span>basename <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>
    <span class="nv">UUID</span><span class="o">=</span><span class="k">$(</span>uuidgen<span class="k">)</span>
    <span class="nv">SNIPPET_FILENAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">/</span><span class="nv">$FILENAME</span><span class="s2"> [</span><span class="nv">$UUID</span><span class="s2">].json&quot;</span>

    <span class="nv">SNIPPET</span><span class="o">=</span><span class="k">$(</span>awk <span class="s1">&#39;BEGIN { start=0 } /%%snipe%%/ { start=1; next } start &amp;&amp; /^```/ { code=1; start=0; next } code &amp;&amp; /^```/ { code=0; next } code { printf &quot;%s\\n&quot;, $0 } END { }&#39;</span> <span class="s2">&quot;</span><span class="nv">$MARKDOWN_FILE</span><span class="s2">&quot;</span><span class="k">)</span>

    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$SNIPPET</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="k">return</span> <span class="m">1</span>
    <span class="k">fi</span>

    touch <span class="s2">&quot;</span><span class="nv">$SNIPPET_FILENAME</span><span class="s2">&quot;</span>

    <span class="nv">ENCODED_SNIPPET</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SNIPPET</span><span class="p">//</span><span class="se">\&quot;</span><span class="p">/</span><span class="se">\\\&quot;</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Replace &quot; with \&quot;</span>

    <span class="nb">printf</span> <span class="s2">&quot;{\n&quot;</span> &gt;&gt; <span class="nv">$SNIPPET_FILENAME</span>
    <span class="nb">printf</span> <span class="s2">&quot;\&quot;alfredsnippet\&quot; : {\n&quot;</span> &gt;&gt; <span class="nv">$SNIPPET_FILENAME</span>
    <span class="nb">printf</span> <span class="s2">&quot;\&quot;snippet\&quot; : \&quot;%s\&quot;,\n&quot;</span> <span class="s2">&quot;</span><span class="nv">$ENCODED_SNIPPET</span><span class="s2">&quot;</span> &gt;&gt; <span class="nv">$SNIPPET_FILENAME</span>
    <span class="nb">printf</span> <span class="s2">&quot;\&quot;uid\&quot; : \&quot;%s\&quot;,\n&quot;</span> <span class="nv">$UUID</span> &gt;&gt; <span class="nv">$SNIPPET_FILENAME</span>
    <span class="nb">printf</span> <span class="s2">&quot;\&quot;name\&quot; : \&quot;%s\&quot;,\n&quot;</span> <span class="s2">&quot;</span><span class="nv">$FILENAME</span><span class="s2">&quot;</span> &gt;&gt; <span class="nv">$SNIPPET_FILENAME</span>
    <span class="nb">printf</span> <span class="s2">&quot;\&quot;keyword\&quot; : \&quot;\&quot;\n&quot;</span> &gt;&gt; <span class="nv">$SNIPPET_FILENAME</span>
    <span class="nb">printf</span> <span class="s2">&quot;}}\n&quot;</span> &gt;&gt; <span class="nv">$SNIPPET_FILENAME</span>
<span class="o">}</span>

<span class="c1"># Clear out anything already in directory</span>
rm <span class="s2">&quot;</span><span class="nv">$ALFRED_SNIPPETS_DIR</span><span class="s2">/&quot;</span>*.json

<span class="nv">FUNCDEFS</span><span class="o">=</span><span class="k">$(</span><span class="nb">typeset</span> -f snipe<span class="k">)</span> find . -name <span class="s2">&quot;*.md&quot;</span> -type f -exec sh -c <span class="s1">&#39;</span>
<span class="s1">   eval &quot;$FUNCDEFS&quot; &amp;&amp;</span>
<span class="s1">     unset -v FUNCDEFS &amp;&amp;</span>
<span class="s1">     snipe &quot;$@&quot;&#39;</span> <span class="o">{}</span> <span class="s2">&quot;</span><span class="nv">$ALFRED_SNIPPETS_DIR</span><span class="s2">&quot;</span> <span class="se">\;</span>
</code></pre>
</div>

<p>I added this to a directory on my path <code class="codeblock">~/bin</code> so I can easily execute it. To use it:</p>

<ol class="list-decimal">
<li>Navigate to your Obsidian vault directory</li>
<li>Run the script (e.g. <code class="codeblock">sniper</code>) without any arguments</li>
<li>That's all. Note that this <em>erases</em> anything already in the snippets collection, which is why I encourage you to create a new one.</li>
<li>Sometimes, I've noticed the snippets don't update immediately, so I had to clear Alfred's cache (Settings -> Advanced -> Clear Application Cache)</li>
</ol>

<h2>Notes</h2>

<ul>
<li>Yeah, this could probably be done with an Obsidian or Alfred extension, but this is one of the simplest possible options for me, and I like knowing what's going on.</li>
<li>This is not so much a tutorial, but if you have questions, let me know. ChatGPT helped me a lot with the scripting, but I learned a lot too.</li>
<li>I encourage you to take a look at this and play around with it. There are some limitations, like only allowing one snippet per file.
The filename is also used as the snippet name, so if the file name doesn't really correspond with the snippet, that might be confusing.
But hey if you keep atomic notes (which I <em>totally definitely</em> do (not)), it shouldn't be an issue.</li>
</ul>

<p>That's all for now. Happy hacking :P</p>

        </article>
    </div>
</body>

</html>