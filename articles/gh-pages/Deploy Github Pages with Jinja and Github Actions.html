<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deploy Github Pages with Jinja and Github Actions</title>
    <link rel="stylesheet" href="../../tailwind.css">
    <link rel="stylesheet" href="../../codestyle.css">
    <link rel="icon" type="image/png" href="../../favicon.png">
    <script src="https://kit.fontawesome.com/675a0d1294.js" crossorigin="anonymous"></script>
    <script data-goatcounter="https://dizzard.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    <style>
        ol {
            list-style-type: decimal;
        }
    </style>
    <script>
        function goBack() {
            window.history.back();
        }
    </script>
</head>

<body class="bg-white dark:bg-slate-800">
    <div class='back-button mt-8 text-center md:text-left md:ml-8'>
        <button class="bg-transparent text-slate-900 dark:text-white" onclick="goBack()">
            ‚Üê Back
        </button>
    </div>
    <div class="m-4 md:flex md:justify-center">
        <article class="prose lg:prose-xl dark:prose-invert">
            <h1>Deploy Github Pages with Jinja and GH Actions</h1>

<p>This blog, like many others is hosted on <a href="https://pages.github.com/">Github Pages</a>. Github Pages is a great (and free) way to post small static sites like personal websites. The annoying thing is that you have to push build code that would <em>usually</em> be included in your <code class="codeblock">.gitignore</code> file. So if you don't want to have to build your site locally, and include the build files in your repository, there is an option for you that leverages Github Actions.</p>

<p>Now, if you haven't heard of <a href="https://github.com/features/actions">Github Actions</a>, you should check it out. It's Github's platform for CI/CD, and it's easily configurable with .yaml files. There's nothing special you have to do for a repository, you just include the action files in the <code class="codeblock">.github/workflows</code> directory.</p>

<p><a href="https://github.com/momja/momja.github.io">My site repository</a> is currently being deployed with a <a href="https://github.com/JamesIves/github-pages-deploy-action">github action</a> written by <a href="https://github.com/JamesIves">@JamesIves</a>. The sample <code class="codeblock">.yaml</code> file looks like this:</p>

<div class="codehilite">
<pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build and Deploy</span><span class="w"></span>
<span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="nt">permissions</span><span class="p">:</span><span class="w"> </span>
<span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span><span class="w"></span>
<span class="nt">jobs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build-and-deploy</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class="w"></span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout üõéÔ∏è</span><span class="w"></span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span><span class="w"></span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install and Build üîß</span><span class="w"></span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">          </span><span class="no">npm ci</span><span class="w"></span>
<span class="w">          </span><span class="no">npm run build</span><span class="w"></span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy üöÄ</span><span class="w"></span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JamesIves/github-pages-deploy-action@v4.3.3</span><span class="w"></span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gh-pages</span><span class="w"></span>
<span class="w">          </span><span class="nt">folder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span><span class="w"></span>
</code></pre>
</div>

<p>There's very little here we have to change to get this working for us.</p>

<ol class="list-decimal">
<li><p>First, make sure this section matches the branch your github site is hosted on. You can check which branch is currently used by opening your github pages repository then:</p>

<p>Settings -> Code and Automation -> Pages -> Source.</p>

<div class="codehilite">
<pre><span></span><code><span class="nt">with</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gh-pages &lt;- make sure this matches &quot;branch&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">folder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span><span class="w"></span>
</code></pre>
</div>

<p><img src="http://dizzard.net/images/setting-gh-pages.jpg" alt="../../images/setting-gh-pages.jpg" /></p></li>
<li><p>Now we need to update the "Install and Build üîß" section. There are a couple things we have to do for this to work, and it will vary for you depending on how your site is being built. I'm generating the static pages of my site using the Jinja web templating engine, and then I inject style with Postcss and Tailwind. This means I need to run a python script to generate the HTML files, then run a postcss injection to transform my css. I've got <a href="https://github.com/momja/momja.github.io/blob/master/package.json">all this configured</a> in my 'package.json' file, so whenever I run <code class="codeblock">npm run build</code>, all this is taken care of. At least that all happens smoothly locally. When running this on some ephemeral virtual machine, you have to actually make sure all the dependencies are downloaded first. For the postcss dependencies, that's as simple as running <code class="codeblock">npm install</code> assuming you've correctly set up your packages.</p>

<p>For Python, it is a little different. I'm not the biggest fan of dependency management in Python, but I recently came across a tool called <a href="https://github.com/bndr/pipreqs">pipreqs</a> which solves the challenges I associate with generating package requirements for Python. To build a requirements.txt file with pipreqs, just run <code class="codeblock">pipreqs</code> in your project directory. You will want to include this requirements file in your git commit, because we will then use it to install all the pip dependencies on the VM used by Github Actions!</p>

<div class="codehilite">
<pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install and Build üîß</span><span class="w"></span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">    </span><span class="no">npm ci</span><span class="w"></span>
<span class="w">    </span><span class="no">npm run build</span><span class="w"></span>
</code></pre>
</div>

<p>becomes:</p>

<div class="codehilite">
<pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install and Build üîß</span><span class="w"></span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">    </span><span class="no">pip install -r requirements.txt</span><span class="w"></span>
<span class="w">    </span><span class="no">npm install</span><span class="w"></span>
<span class="w">    </span><span class="no">npm run build</span><span class="w"></span>
</code></pre>
</div></li>
<li><p>Lastly, I didn't want the <code class="codeblock">gh-pages</code> branch to be updated each time a change is made to <em>any</em> branch, so I changed the yaml field at the top of the file for when the action should be triggered:</p>

<div class="codehilite">
<pre><span></span><code><span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">]</span><span class="w"></span>
</code></pre>
</div>

<p>becomes:</p>

<div class="codehilite">
<pre><span></span><code><span class="nt">on</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">push</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">branches</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span><span class="w"></span>
</code></pre>
</div></li>
</ol>

<p>And there you have it! Check out the final file <a href="https://github.com/momja/momja.github.io/blob/38e1a2985c1983cbd35c07d970318d8743cb63ba/.github/workflows/deploy-to-gh-pages.yml">here</a></p>

        </article>
    </div>
    <div class="p-5 m-4 md:flex md:justify-center">
        <!-- kofi button -->
        <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Support Me on Ko-fi', '#000000', 'I2I4QBRVN');kofiwidget2.draw();</script>
    </div>

</body>

</html>